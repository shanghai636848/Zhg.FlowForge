<!-- 中央画布面板 - 优化版 -->
<div class="relative flex min-w-0 flex-1 flex-col bg-gradient-to-br from-white via-slate-50/30 to-blue-50/20 backdrop-blur-sm">
    <!-- 画布工具栏 -->
    <div class="flex h-12 items-center justify-between border-b border-slate-200/60 bg-gradient-to-r from-slate-50 via-blue-50/50 to-purple-50/50 px-4 py-2 shadow-sm backdrop-blur-md">
        <!-- 左侧 - 导入导出 -->
        <div class="flex items-center gap-2">
            <!-- 导入 -->
            <button class="group flex items-center gap-2 rounded-lg border border-emerald-200 bg-gradient-to-r from-emerald-50 to-teal-50 px-3 py-2 text-sm font-medium text-emerald-700 shadow-sm transition-all hover:scale-105 hover:border-emerald-300 hover:from-emerald-100 hover:to-teal-100 hover:shadow-md active:scale-95"
                    @onclick="OnImportBpmn">
                <i class="fas fa-file-import text-sm transition-transform group-hover:rotate-12"></i>
                <span class="hidden sm:inline">导入</span>
            </button>

            <!-- 导出 -->
            <button class="group flex items-center gap-2 rounded-lg border border-blue-200 bg-gradient-to-r from-blue-50 to-indigo-50 px-3 py-2 text-sm font-medium text-blue-700 shadow-sm transition-all hover:scale-105 hover:border-blue-300 hover:from-blue-100 hover:to-indigo-100 hover:shadow-md active:scale-95"
                    @onclick="OnExportBpmn">
                <i class="fas fa-file-export text-sm transition-transform group-hover:rotate-12"></i>
                <span class="hidden sm:inline">导出</span>
            </button>
        </div>

        <!-- 右侧 - 编辑和视图控制 -->
        <div class="flex items-center gap-2">
            <!-- 撤销 -->
            <button class="@GetIconButtonClass("amber")" @onclick="OnUndo" title="撤销 (Ctrl+Z)">
                <i class="fas fa-undo text-sm"></i>
            </button>

            <!-- 重做 -->
            <button class="@GetIconButtonClass("amber")" @onclick="OnRedo" title="重做 (Ctrl+Y)">
                <i class="fas fa-redo text-sm"></i>
            </button>

            <div class="mx-2 h-6 w-px bg-gradient-to-b from-transparent via-slate-300 to-transparent"></div>

            <!-- 缩小 -->
            <button class="@GetIconButtonClass("cyan")" @onclick="OnZoomOut" title="缩小">
                <i class="fas fa-search-minus text-sm"></i>
            </button>

            <!-- 重置 100% -->
            <button class="@GetIconButtonClass("indigo")" @onclick="OnResetZoom" title="重置 100%">
                <span class="text-xs font-bold">@((CurrentZoom * 100).ToString("0"))%</span>
            </button>

            <!-- 放大 -->
            <button class="@GetIconButtonClass("cyan")" @onclick="OnZoomIn" title="放大">
                <i class="fas fa-search-plus text-sm"></i>
            </button>

            <div class="mx-2 h-6 w-px bg-gradient-to-b from-transparent via-slate-300 to-transparent"></div>

            <!-- 适应窗口 -->
            <button class="@GetIconButtonClass("teal")" @onclick="OnFitViewport" title="适应画布">
                <i class="fas fa-compress-arrows-alt text-sm"></i>
            </button>

            <!-- 重置视图 -->
            <button class="@GetIconButtonClass("teal")" @onclick="OnResetZoom" title="重置缩放">
                <i class="fas fa-expand text-sm"></i>
            </button>
        </div>
    </div>

    <!-- 画布 - 带网格背景 -->
    <div id="canvas" class="bpmn-canvas relative flex-1"></div>

    <!-- 悬浮面板切换按钮 - 相对于视口固定 -->
    @if (!LeftPanelOpen)
    {
        <button @onclick="() => OnOpenLeftPanel.InvokeAsync()"
                class="fixed left-4 top-20 z-50 flex h-12 w-12 items-center justify-center rounded-xl border-2 border-violet-300 bg-gradient-to-br from-violet-500 to-fuchsia-500 text-white shadow-2xl transition-all hover:scale-110 hover:shadow-violet-500/50 active:scale-95 md:hidden"
                title="打开工具箱">
            <i class="fas fa-bars text-lg"></i>
        </button>
    }

    @if (!RightPanelOpen)
    {
        <button @onclick="() => OnOpenRightPanel.InvokeAsync()"
                class="fixed right-4 top-20 z-50 flex h-12 w-12 items-center justify-center rounded-xl border-2 border-fuchsia-300 bg-gradient-to-br from-fuchsia-500 to-pink-500 text-white shadow-2xl transition-all hover:scale-110 hover:shadow-fuchsia-500/50 active:scale-95 xl:hidden"
                title="打开属性面板">
            <i class="fas fa-sliders-h text-lg"></i>
        </button>
    }
</div>

<style>
    /* 网格背景样式 */
    .bpmn-canvas {
        background-color: #fafafa;
        background-image: linear-gradient(rgba(148, 163, 184, 0.08) 1px, transparent 1px), linear-gradient(90deg, rgba(148, 163, 184, 0.08) 1px, transparent 1px), linear-gradient(rgba(148, 163, 184, 0.04) 1px, transparent 1px), linear-gradient(90deg, rgba(148, 163, 184, 0.04) 1px, transparent 1px);
        background-size: 50px 50px, 50px 50px, 10px 10px, 10px 10px;
        background-position: -1px -1px, -1px -1px, -1px -1px, -1px -1px;
    }
</style>

@code {
    [Parameter] public double CurrentZoom { get; set; } = 1.0;
    [Parameter] public bool LeftPanelOpen { get; set; } = true;
    [Parameter] public bool RightPanelOpen { get; set; } = true;
    [Parameter] public EventCallback OnExportBpmn { get; set; }
    [Parameter] public EventCallback OnImportBpmn { get; set; }
    [Parameter] public EventCallback OnUndo { get; set; }
    [Parameter] public EventCallback OnRedo { get; set; }
    [Parameter] public EventCallback OnZoomIn { get; set; }
    [Parameter] public EventCallback OnZoomOut { get; set; }
    [Parameter] public EventCallback OnResetZoom { get; set; }
    [Parameter] public EventCallback OnFitViewport { get; set; }
    [Parameter] public EventCallback OnTogglePalette { get; set; }
    [Parameter] public EventCallback OnOpenLeftPanel { get; set; }
    [Parameter] public EventCallback OnOpenRightPanel { get; set; }

    private string GetIconButtonClass(string color)
    {
        return $"group flex h-8 w-8 items-center justify-center rounded-lg border border-{color}-200 bg-gradient-to-br from-{color}-50 to-{color}-100/50 text-{color}-600 shadow-sm transition-all hover:scale-110 hover:border-{color}-300 hover:shadow-md active:scale-95";
    }
}