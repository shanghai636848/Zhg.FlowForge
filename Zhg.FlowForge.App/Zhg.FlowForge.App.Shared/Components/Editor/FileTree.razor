@using Zhg.FlowForge.App.Shared.Services

<div class="group relative"
	 @onmouseover="() => IsHovering = true"
	 @onmouseout="() => IsHovering = false">

	<button class="flex w-full items-center gap-2 rounded px-2 py-1.5 text-xs transition-colors
                  @(IsSelected ? "bg-blue-600 text-white" : "text-slate-300 hover:bg-slate-700")"
			@onclick="OnClick"
			@oncontextmenu:preventDefault="true"
			@* @oncontextmenu=ShowContextMenu *@
	>

		@if (File.IsFolder)
		{
			<i class="fas @(IsExpanded ? "fa-folder-open" : "fa-folder") text-xs text-amber-400"></i>
		}
		else
		{
			<i class="@GetFileIcon() text-xs"></i>
		}

		<span class="flex-1 truncate">@File.Name</span>

		@if (File.IsDirty)
		{
			<i class="fas fa-circle text-[0.375rem] text-amber-500"></i>
		}
	</button>

	<!-- 右键菜单 -->
	@if (ShowContextMenu)
	{
		<div class="absolute top-full left-0 z-50 mt-1 w-48 rounded-lg border border-slate-600 bg-slate-700 py-1 shadow-xl"
			 @onclick:stopPropagation="true">
			<button class="w-full px-3 py-1.5 text-left text-xs text-slate-200 hover:bg-slate-600"
					@onclick="Rename">
				<i class="fas fa-edit w-4"></i> 重命名
			</button>
			<button class="w-full px-3 py-1.5 text-left text-xs text-slate-200 hover:bg-slate-600"
					@onclick="Duplicate">
				<i class="fas fa-copy w-4"></i> 复制
			</button>
			<div class="my-1 h-px bg-slate-600"></div>
			<button class="w-full px-3 py-1.5 text-left text-xs text-rose-400 hover:bg-slate-600"
					@onclick="Delete">
				<i class="fas fa-trash w-4"></i> 删除
			</button>
		</div>
	}
</div>

@code {
    [Parameter] public Services.ProjectFile File { get; set; } = new();
    [Parameter] public bool IsSelected { get; set; }
	[Parameter] public EventCallback OnClick { get; set; }
	[Parameter] public EventCallback OnRename { get; set; }
	[Parameter] public EventCallback OnDelete { get; set; }

	private bool IsExpanded = false;
	private bool IsHovering = false;
	private bool ShowContextMenu = false;

	private string GetFileIcon()
	{
		var ext = Path.GetExtension(File.Path).ToLower();
		return ext switch
		{
			".cs" => "fas fa-file-code text-blue-400",
			".razor" => "fas fa-file-code text-purple-400",
			".json" => "fas fa-brackets-curly text-amber-400",
			".xml" => "fas fa-code text-rose-400",
			_ => "fas fa-file text-slate-400"
		};
	}

	private void Rename()
	{
		ShowContextMenu = false;
		OnRename.InvokeAsync();
	}

	private void Duplicate()
	{
		ShowContextMenu = false;
	}

	private void Delete()
	{
		ShowContextMenu = false;
		OnDelete.InvokeAsync();
	}
}