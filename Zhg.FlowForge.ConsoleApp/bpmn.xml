<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:zhg="https://www.kswitvalley.net/bpmn" id="Definitions_OrderProcess" targetNamespace="http://example.org/order-process">
	<bpmn:process id="OrderProcess" isExecutable="true">
		<bpmn:startEvent id="StartEvent_1" name="开始" />
		<bpmn:serviceTask id="Task_ProcessOrder" name="处理订单">
			<bpmn:extensionElements>
				<zhg:class>com.example.handler.ProcessOrderHandler</zhg:class>
				<zhg:inputOutput>
					<zhg:inputParameter name="orderId" type="string">orderId</zhg:inputParameter>
					<zhg:inputParameter name="amount" type="long">1000</zhg:inputParameter>
					<zhg:inputParameter name="user" type="json">${currentUser}</zhg:inputParameter>
					<zhg:outputParameter name="status" type="string">taskStatus</zhg:outputParameter>
					<zhg:outputParameter name="success" type="boolean">isSuccess</zhg:outputParameter>
				</zhg:inputOutput>
			</bpmn:extensionElements>
		</bpmn:serviceTask>
		<bpmn:exclusiveGateway id="Gateway_CheckResult" name="验证结果" />
		<bpmn:serviceTask id="Task_Success" name="订单成功">
			<bpmn:extensionElements>
				<zhg:class>com.example.handler.SuccessHandler</zhg:class>
				<zhg:inputOutput>
					<zhg:inputParameter name="orderId" type="string">${orderId}</zhg:inputParameter>
					<zhg:outputParameter name="result" type="string">"success"</zhg:outputParameter>
				</zhg:inputOutput>
			</bpmn:extensionElements>
		</bpmn:serviceTask>
		<bpmn:serviceTask id="Task_Failure" name="订单失败">
			<bpmn:extensionElements>
				<zhg:class>com.example.handler.FailureHandler</zhg:class>
				<zhg:inputOutput>
					<zhg:inputParameter name="orderId" type="string">${orderId}</zhg:inputParameter>
					<zhg:inputParameter name="errorMessage" type="string">${errorMsg}</zhg:inputParameter>
					<zhg:outputParameter name="result" type="string">"failed"</zhg:outputParameter>
				</zhg:inputOutput>
			</bpmn:extensionElements>
		</bpmn:serviceTask>
		<bpmn:endEvent id="EndEvent_1" name="结束" />
		<bpmn:sequenceFlow id="Flow_Start_To_Process" sourceRef="StartEvent_1" targetRef="Task_ProcessOrder" />
		<bpmn:sequenceFlow id="Flow_Process_To_Gateway" sourceRef="Task_ProcessOrder" targetRef="Gateway_CheckResult" />
		<bpmn:sequenceFlow id="Flow_Gateway_To_Success" sourceRef="Gateway_CheckResult" targetRef="Task_Success">
			<bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${isSuccess == true}</bpmn:conditionExpression>
		</bpmn:sequenceFlow>
		<bpmn:sequenceFlow id="Flow_Gateway_To_Failure" sourceRef="Gateway_CheckResult" targetRef="Task_Failure">
			<bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${isSuccess == false}</bpmn:conditionExpression>
		</bpmn:sequenceFlow>
		<bpmn:sequenceFlow id="Flow_Success_To_End" sourceRef="Task_Success" targetRef="EndEvent_1" />
		<bpmn:sequenceFlow id="Flow_Failure_To_End" sourceRef="Task_Failure" targetRef="EndEvent_1" />
	</bpmn:process>
	<bpmndi:BPMNDiagram id="Diagram_OrderProcess">
		<bpmndi:BPMNPlane id="Plane_OrderProcess" bpmnElement="OrderProcess">
			<bpmndi:BPMNEdge id="Edge_Flow_Failure_To_End" bpmnElement="Flow_Failure_To_End">
				<di:waypoint x="705" y="300" />
				<di:waypoint x="810" y="300" />
				<di:waypoint x="810" y="220" />
				<di:waypoint x="852" y="220" />
			</bpmndi:BPMNEdge>
			<bpmndi:BPMNEdge id="Edge_Flow_Success_To_End" bpmnElement="Flow_Success_To_End">
				<di:waypoint x="705" y="140" />
				<di:waypoint x="810" y="140" />
				<di:waypoint x="810" y="220" />
				<di:waypoint x="852" y="220" />
			</bpmndi:BPMNEdge>
			<bpmndi:BPMNEdge id="Edge_Flow_Gateway_To_Failure" bpmnElement="Flow_Gateway_To_Failure">
				<di:waypoint x="430" y="220" />
				<di:waypoint x="460" y="220" />
				<di:waypoint x="460" y="300" />
				<di:waypoint x="585" y="300" />
			</bpmndi:BPMNEdge>
			<bpmndi:BPMNEdge id="Edge_Flow_Gateway_To_Success" bpmnElement="Flow_Gateway_To_Success">
				<di:waypoint x="430" y="220" />
				<di:waypoint x="460" y="220" />
				<di:waypoint x="460" y="140" />
				<di:waypoint x="585" y="140" />
			</bpmndi:BPMNEdge>
			<bpmndi:BPMNEdge id="Edge_Flow_Process_To_Gateway" bpmnElement="Flow_Process_To_Gateway">
				<di:waypoint x="320" y="218" />
				<di:waypoint x="380" y="218" />
			</bpmndi:BPMNEdge>
			<bpmndi:BPMNEdge id="Edge_Flow_Start_To_Process" bpmnElement="Flow_Start_To_Process">
				<di:waypoint x="136" y="218" />
				<di:waypoint x="200" y="218" />
			</bpmndi:BPMNEdge>
			<bpmndi:BPMNShape id="Shape_StartEvent_1" bpmnElement="StartEvent_1">
				<dc:Bounds x="100" y="200" width="36" height="36" />
			</bpmndi:BPMNShape>
			<bpmndi:BPMNShape id="Shape_Task_ProcessOrder" bpmnElement="Task_ProcessOrder">
				<dc:Bounds x="200" y="180" width="120" height="80" />
			</bpmndi:BPMNShape>
			<bpmndi:BPMNShape id="Shape_Gateway_CheckResult" bpmnElement="Gateway_CheckResult" isMarkerVisible="true">
				<dc:Bounds x="380" y="195" width="50" height="50" />
				<bpmndi:BPMNLabel>
					<dc:Bounds x="383" y="171" width="44" height="14" />
				</bpmndi:BPMNLabel>
			</bpmndi:BPMNShape>
			<bpmndi:BPMNShape id="Shape_Task_Success" bpmnElement="Task_Success">
				<dc:Bounds x="585" y="100" width="120" height="80" />
			</bpmndi:BPMNShape>
			<bpmndi:BPMNShape id="Shape_Task_Failure" bpmnElement="Task_Failure">
				<dc:Bounds x="585" y="260" width="120" height="80" />
			</bpmndi:BPMNShape>
			<bpmndi:BPMNShape id="Shape_EndEvent_1" bpmnElement="EndEvent_1">
				<dc:Bounds x="852" y="202" width="36" height="36" />
				<bpmndi:BPMNLabel>
					<dc:Bounds x="859" y="178" width="22" height="14" />
				</bpmndi:BPMNLabel>
			</bpmndi:BPMNShape>
		</bpmndi:BPMNPlane>
	</bpmndi:BPMNDiagram>
</bpmn:definitions>